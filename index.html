<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HACCP-CMR Documentation Builder - √âlelmiszerbiztons√°gi dokument√°ci√≥ k√©sz√≠t≈ë alkalmaz√°s">
    <meta name="theme-color" content="#2563eb">
    <title>HACCP-CMR Documentation Builder</title>
    
    <!-- Quill CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- CRM Form Helpers -->
    <script src="crm-form-helpers.js" defer></script>
</head>
<body>
    <!-- Skip to Main Content -->
    <a href="#main-content" class="skip-link">Ugr√°s a tartalomra</a>
    
    <!-- Main Application Container -->
    <div id="app" role="application" aria-label="HACCP-CMR Documentation Builder">
        <!-- Header -->
        <header class="header" role="banner">
            <div class="header-left">
                <h1>HACCP-CMR Documentation Builder</h1>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" onclick="exportToWord()" aria-label="Export√°l√°s Word form√°tumba">
                    <span aria-hidden="true">üìÑ</span> Export√°l√°s Word-be
                </button>
                <button class="btn btn-secondary" onclick="openBackupModal()" aria-label="Ment√©s √©s vissza√°ll√≠t√°s">
                    <span aria-hidden="true">üíæ</span> Ment√©s/Vissza√°ll√≠t√°s
                </button>
                <span class="version-badge" aria-label="Verzi√≥ 2.0.0">v2.0.0</span>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-container">
            <!-- Sidebar -->
            <aside class="sidebar" role="complementary" aria-label="Navig√°ci√≥s panel">
                <!-- Tab Navigation -->
                <nav class="tab-navigation" role="tablist" aria-label="F≈ë navig√°ci√≥">
                    <button class="tab-btn active" 
                            role="tab"
                            aria-selected="true"
                            aria-controls="documents-tab"
                            onclick="switchTab('documents')" 
                            data-tab="documents">
                        <span aria-hidden="true">üìÑ</span> Dokumentumok
                    </button>
                    <button class="tab-btn" 
                            role="tab"
                            aria-selected="false"
                            aria-controls="blocks-tab"
                            onclick="switchTab('blocks')" 
                            data-tab="blocks">
                        <span aria-hidden="true">üß±</span> Blokkok
                    </button>
                    <button class="tab-btn" 
                            role="tab"
                            aria-selected="false"
                            aria-controls="clients-tab"
                            onclick="switchTab('clients')" 
                            data-tab="clients">
                        <span aria-hidden="true">üë•</span> √úgyfelek
                    </button>
                    <button class="tab-btn" 
                            role="tab"
                            aria-selected="false"
                            aria-controls="templates-tab"
                            onclick="switchTab('templates')" 
                            data-tab="templates">
                        <span aria-hidden="true">üìã</span> Sablonok
                    </button>
                </nav>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Documents Tab -->
                    <div id="documents-tab" class="tab-pane active">
                        <div class="tab-header">
                            <h3>Dokumentumok</h3>
                            <button class="btn btn-small btn-primary" onclick="createNewDocument()">
                                + √öj dokumentum
                            </button>
                        </div>
                        <div style="padding: 0 var(--spacing-md) var(--spacing-md);">
                            <input type="text" 
                                   id="document-search" 
                                   class="form-input" 
                                   placeholder="üîç Keres√©s dokumentumok k√∂z√∂tt..." 
                                   oninput="filterDocuments(this.value)"
                                   style="margin-bottom: var(--spacing-sm);">
                        </div>
                        <div id="documents-list" class="list-container">
                            <!-- Documents will be rendered here -->
                        </div>
                    </div>

                    <!-- Blocks Tab -->
                    <div id="blocks-tab" class="tab-pane">
                        <div class="tab-header">
                            <h3>Blokk Csoportok</h3>
                            <button class="btn btn-small btn-primary" onclick="createNewGroup()">
                                + √öj csoport
                            </button>
                        </div>
                        <div id="blocks-list" class="list-container">
                            <!-- Block groups will be rendered here -->
                        </div>
                    </div>

                    <!-- Clients Tab -->
                    <div id="clients-tab" class="tab-pane">
                        <div class="tab-header">
                            <h3>√úgyfelek</h3>
                            <button class="btn btn-small btn-primary" onclick="createNewClient()">
                                + √öj √ºgyf√©l
                            </button>
                        </div>
                        <div id="clients-list" class="list-container">
                            <!-- Clients will be rendered here -->
                        </div>
                    </div>

                    <!-- Templates Tab -->
                    <div id="templates-tab" class="tab-pane">
                        <div class="tab-header">
                            <h3>Sablonok</h3>
                            <button class="btn btn-small btn-primary" onclick="saveCurrentAsTemplate()">
                                + Ment√©s sablonk√©nt
                            </button>
                        </div>
                        <div id="templates-list" class="list-container">
                            <!-- Templates will be rendered here -->
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Canvas -->
            <main class="canvas" id="main-content" role="main" aria-label="Dokumentum szerkeszt≈ë">
                <div id="document-editor">
                    <div class="canvas-header">
                        <label for="document-title" class="sr-only">Dokumentum c√≠me</label>
                        <input type="text" 
                               id="document-title" 
                               class="document-title-input" 
                               placeholder="Dokumentum c√≠me..." 
                               onchange="updateDocumentTitle()"
                               aria-label="Dokumentum c√≠me">
                        <div class="canvas-actions">
                            <label for="client-selector" class="sr-only">√úgyf√©l kiv√°laszt√°sa</label>
                            <select id="client-selector" 
                                    onchange="assignClientToDocument()"
                                    aria-label="√úgyf√©l kiv√°laszt√°sa">
                                <option value="">V√°lassz √ºgyfelet...</option>
                            </select>
                        </div>
                    </div>
                    <div id="blocks-canvas" 
                         class="blocks-canvas" 
                         role="region" 
                         aria-label="Dokumentum tartalma"
                         aria-live="polite">
                        <!-- Document blocks will be rendered here -->
                        <div class="empty-state">
                            <p aria-hidden="true">üß±</p>
                            <p>H√∫zd ide a blokkokat a bal oldali men√ºb≈ël</p>
                            <p>vagy kattints az "√öj blokk hozz√°ad√°sa" gombra</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- Block Editor Modal -->
    <div id="block-editor-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>Blokk szerkeszt√©se</h2>
                <button class="close-btn" onclick="closeBlockEditor()">&times;</button>
            </div>
            <div class="modal-body">
                <label>Blokk neve:</label>
                <input type="text" id="block-name-input" class="form-input">
                
                <label>Tartalom:</label>
                <div id="block-content-editor"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBlockEditor()">M√©gse</button>
                <button class="btn btn-primary" onclick="saveBlock()">Ment√©s</button>
            </div>
        </div>
    </div>

    <!-- Client Editor Modal - Comprehensive CRM -->
    <div id="client-editor-modal" class="modal-overlay">
        <div class="modal modal-large">
            <div class="modal-header">
                <h2 id="client-modal-title">√úgyf√©l rizik√≥√©rt√©kel√©si ≈±rlap</h2>
                <button class="close-btn" onclick="closeClientEditor()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <!-- Comprehensive CRM Form will be generated here dynamically -->
                <div id="comprehensive-crm-form"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeClientEditor()">Bez√°r√°s</button>
                <button class="btn btn-primary" onclick="saveComprehensiveClient()">Ment√©s</button>
            </div>
        </div>
    </div>
                        <input type="text" id="client-industry" class="form-input">
                    </div>
                    <div>
                        <label>Weboldal</label>
                        <input type="url" id="client-website" class="form-input">
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <label>Megjegyz√©sek</label>
                    <textarea id="client-notes" class="form-textarea" rows="4"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeClientEditor()">M√©gse</button>
                <button class="btn btn-primary" onclick="saveClient()">Ment√©s</button>
            </div>
        </div>
    </div>

    <!-- Backup/Restore Modal -->
    <div id="backup-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>Ment√©s √©s Vissza√°ll√≠t√°s</h2>
                <button class="close-btn" onclick="closeBackupModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="backup-section">
                    <h3>üíæ Teljes ment√©s l√©trehoz√°sa</h3>
                    <p>Az √∂sszes dokumentum, √ºgyf√©l, sablon √©s blokk ment√©se JSON f√°jlba.</p>
                    <button class="btn btn-primary" onclick="createBackup()">Ment√©s let√∂lt√©se</button>
                </div>
                <hr>
                <div class="backup-section">
                    <h3>üìÇ Vissza√°ll√≠t√°s f√°jlb√≥l</h3>
                    <p>Kor√°bbi ment√©s vissza√°ll√≠t√°sa. <strong>FIGYELEM:</strong> Ez fel√ºl√≠rja a jelenlegi adatokat!</p>
                    <input type="file" id="backup-file-input" accept=".json">
                    <button class="btn btn-secondary" onclick="restoreBackup()">Vissza√°ll√≠t√°s</button>
                </div>
                <hr>
                <div class="backup-section">
                    <h3>üóëÔ∏è Minden adat t√∂rl√©se</h3>
                    <p>Az √∂sszes adat v√©gleges t√∂rl√©se. Ez a m≈±velet <strong>nem visszavonhat√≥!</strong></p>
                    <button class="btn btn-danger" onclick="clearAllData()">Minden t√∂rl√©se</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBackupModal()">Bez√°r√°s</button>
            </div>
        </div>
    </div>

    <!-- Group Editor Modal -->
    <div id="group-editor-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>Csoport szerkeszt√©se</h2>
                <button class="close-btn" onclick="closeGroupEditor()">&times;</button>
            </div>
            <div class="modal-body">
                <label>Csoport neve:</label>
                <input type="text" id="group-name-input" class="form-input">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeGroupEditor()">M√©gse</button>
                <button class="btn btn-primary" onclick="saveGroup()">Ment√©s</button>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    
    <!-- Application JavaScript -->
    <script src="app.js"></script>
</body>
</html>
